<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editar Portafolio</title>
  <style>
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      margin: 5px 0;
      padding: 8px;
      background: #f0f0f0;
      cursor: move;
    }
  </style>
</head>
<body>
  <h2>Editar Portafolio</h2>

  <!-- Subir trabajo (C5) -->
  <h3>Agregar nuevo trabajo</h3>
  <form id="formSubirTrabajo">
    <input type="file" id="archivo" accept=".jpg,.png,.pdf,.mp4" required>
    <button type="submit">Subir trabajo</button>
    <p id="mensajeSubida"></p>
  </form>

  <!-- Botón para organizar automáticamente por fecha -->
  <button id="organizarAutomaticamente">Organizar automáticamente por fecha</button>

  <!-- Lista de trabajos -->
  <h3>Trabajos en el portafolio</h3>
  <ul id="listaTrabajos">
    <!-- Trabajos aparecerán aquí -->
  </ul>

  <!-- Botón para guardar organización -->
  <button id="guardarOrden">Guardar organización</button>
  <p id="mensajeOrden"></p>

  <script>
    const form = document.getElementById('formSubirTrabajo');
    const archivoInput = document.getElementById('archivo');
    const mensajeSubida = document.getElementById('mensajeSubida');
    const lista = document.getElementById('listaTrabajos');
    const botonGuardar = document.getElementById('guardarOrden');
    const mensajeOrden = document.getElementById('mensajeOrden');
    const botonOrganizar = document.getElementById('organizarAutomaticamente');

    let trabajos = [];

    // Subir trabajo
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const archivo = archivoInput.files[0];

      if (!archivo) return;

      // Tipos de archivo válidos: solo .jpg, .png, .pdf, .mp4
      const tiposValidos = ['image/jpeg', 'image/png', 'application/pdf', 'video/mp4'];
      // Tipos de archivo no permitidos: .rar, .mp3, .zip
      const tiposNoPermitidos = ['application/x-rar-compressed', 'audio/mp3', 'application/zip'];

      if (tiposNoPermitidos.includes(archivo.type)) {
        mensajeSubida.style.color = 'red';
        mensajeSubida.textContent = 'Archivo no válido. Solo se permiten .jpg, .png, .pdf y .mp4';
        return;
      }

      if (!tiposValidos.includes(archivo.type)) {
        mensajeSubida.style.color = 'red';
        mensajeSubida.textContent = 'Archivo no permitido. Solo formatos .jpg, .png, .pdf y .mp4 son válidos';
        return;
      }

      const nuevoTrabajo = {
        nombre: archivo.name,
        fecha: new Date().toISOString()
      };
      trabajos.push(nuevoTrabajo);
      renderLista();
      mensajeSubida.style.color = 'green';
      mensajeSubida.textContent = 'Trabajo añadido';
      archivoInput.value = '';
    });

    // Renderizar lista
    function renderLista() {
      lista.innerHTML = '';
      trabajos.forEach((trabajo, index) => {
        const li = document.createElement('li');
        li.draggable = true;
        li.textContent = ${trabajo.nombre} (Fecha: ${new Date(trabajo.fecha).toLocaleString()});
        li.dataset.index = index;
        lista.appendChild(li);
      });
      aplicarDragDrop();
    }

    // Reordenar por drag & drop
    function aplicarDragDrop() {
      let draggedItem = null;

      lista.querySelectorAll('li').forEach(item => {
        item.addEventListener('dragstart', () => {
          draggedItem = item;
        });

        item.addEventListener('dragover', (e) => {
          e.preventDefault();
        });

        item.addEventListener('drop', () => {
          if (draggedItem !== item) {
            const from = parseInt(draggedItem.dataset.index);
            const to = parseInt(item.dataset.index);
            const temp = trabajos[from];
            trabajos.splice(from, 1);
            trabajos.splice(to, 0, temp);
            renderLista();
          }
        });
      });
    }

    // Organizar automáticamente por fecha
    botonOrganizar.addEventListener('click', () => {
      if (trabajos.length > 1) {
        trabajos.sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
        renderLista();
        mensajeOrden.style.color = 'green';
        mensajeOrden.textContent = 'Orden aplicado (por fecha)';
      } else {
        mensajeOrden.style.color = 'red';
        mensajeOrden.textContent = 'No hay suficientes trabajos para organizar';
      }
    });

    // Guardar organización
    botonGuardar.addEventListener('click', () => {
      if (trabajos.length === 0) {
        mensajeOrden.style.color = 'red';
        mensajeOrden.textContent = 'Error al guardar los cambios';
        return;
      }

      // Verificar si realmente se ha cambiado el orden
      const listaOriginal = trabajos.slice();
      const trabajosOrdenados = [...trabajos].sort((a, b) => new Date(a.fecha) - new Date(b.fecha));

      if (JSON.stringify(listaOriginal) !== JSON.stringify(trabajosOrdenados)) {
        mensajeOrden.style.color = 'green';
        mensajeOrden.textContent = 'Cambios aplicados correctamente';
      } else {
        mensajeOrden.style.color = 'red';
        mensajeOrden.textContent = 'Error al guardar los cambios';
      }
    });
  </script>
</body>
</html>
